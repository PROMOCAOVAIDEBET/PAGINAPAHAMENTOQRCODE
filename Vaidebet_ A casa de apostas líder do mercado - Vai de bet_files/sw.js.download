function e(e){try{var t=atob(e);return JSON.parse(t)||[]}catch(e){return[]}}importScripts('https://progressier.com/myapp/resource-matching.js?v=7i9e');const t="false",o="https://progressier.com",r='false',a=e('W3sibmFtZSI6IlJlc291cmNlcyB0byBrZWVwIHVwLXRvLWRhdGUiLCJzdHJhdCI6Im50byIsImZpbHRlcnMiOltdfSx7Im5hbWUiOiJGb250IGZpbGVzIiwic3RyYXQiOiJzd3IiLCJmaWx0ZXJzIjpbW3siZmllbGQiOiJtZXRob2QiLCJjb21wYXJhdG9yIjoiPT0iLCJ2YWx1ZSI6IkdFVCJ9XSxbeyJmaWVsZCI6InVybCIsImNvbXBhcmF0b3IiOiIoLT0pIiwidmFsdWUiOiJodHRwczovL2ZvbnRzLmdvb2dsZWFwaXMuY29tIn0seyJmaWVsZCI6InVybCIsImNvbXBhcmF0b3IiOiIoLT0pIiwidmFsdWUiOiJodHRwczovL2ZvbnRzLmdzdGF0aWMuY29tIn0seyJmaWVsZCI6InVybCIsImNvbXBhcmF0b3IiOiIoLSkiLCJ2YWx1ZSI6ImZvbnQtYXdlc29tZSJ9LHsiZmllbGQiOiJ0eXBlIiwiY29tcGFyYXRvciI6Ij09IiwidmFsdWUiOiJmb250In1dXX1d'),i=e('W10='),c=e('W10='),s=e('W10='),u=e('W10='),n="progressier-cache",l="progressierPostRequests",d="progressierSavedPushNotifications";function f(){var e=t.toLowerCase();return t,"true"===e}function h(...e){try{"true"===r&&console.log(...e)}catch(e){}}function w(n){return new Promise(function(t,r){try{if(!indexedDB)return null;var e=indexedDB.open(n,1);e.onupgradeneeded=function(){try{this.result.createObjectStore(n,{autoIncrement:!0,keyPath:'id'})}catch(e){h(e)}},e.onsuccess=function(){try{var e=this.result.transaction(n,"readwrite").objectStore(n);return t(e)}catch(e){h(e)}}}catch(e){return h(e),r()}})}function p(e,t){return new Response(null,{status:e,statusText:t,headers:{"cache-control":"no-store"}})}function y(e,t){try{return(new ResourceMatching).urlsMatch(e,t)}catch(e){return!1}}async function v(){return await caches.open(n)}async function g(e,t){try{var r;t&&new URL(e).protocol.includes('http')&&(i=t.status,[0,200,201,202,203,204,205,206].includes(i))&&(!function(t,e){try{if(new URL(t).origin===o)return}catch(e){}e=(new ResourceMatching).hasNoStore(e);let r=!1;return u.forEach(function(e){y(e,t)&&(r=!0)}),!(e&&r||!e)}(e,L(t.headers))?(r=0===(n=t).status?n.clone():(delete(a=L((n=n.clone()).headers))['cache-control'],new Response(n.body,{type:n.type||"default",status:n.status,statusText:n.statusText,headers:a})),await(await v()).put(e,r)):h(e,'shouldnt store'))}catch(e){h(e)}var n,a,i}function m(t){let r=null,n=null;if(s.forEach(function(e){r||y(e.original,t)&&(r=e.fallback,n=e.original)}),!r)return null;let e=r;return(e=n.includes("*")?e:function(e,t){try{var r,n=new URL(e).searchParams,a=new URL(t),i=a.searchParams;for(r of n.entries())i.get(r[0])||i.set(r[0],r[1]);return a.href}catch(e){h(e)}}(t,r))||r}async function b(t){var e;let r={};["url","method","referrer","referrerPolicy","mode","credentials","cache","redirect","integrity","destination"].forEach(function(e){t[e]&&(r[e]=t[e])});try{t.headers&&t.headers.entries?r.headers=L(t.headers):t.headers&&"object"==typeof t.headers&&(r.headers=JSON.parse(JSON.stringify(t.headers))),t.body&&(r.body="object"==typeof t.body?JSON.stringify(t.body):t.body),t.json&&(e=await t.json())&&"GET"!==t.method&&"HEAD"!==t.method&&(r.body=JSON.stringify(e))}catch(e){h(e)}return r}async function q(t,e){var r=t.request,n=r.url,a=r.clone();try{var i=t&&t.preloadResponse?await t.preloadResponse:null;if(i)return h(t.url,'preload available',i),i;var s=await fetch(r,{cache:e?"no-store":"default"});if(h(s,'network res available'),s&&s.status&&499<s.status)throw s.statusText||s.status+" Server Error";return s}catch(e){if(h(e),"PUT"===r.method||"POST"===r.method){t=await async function(e,t){try{var r=m(t);if(!r)throw"No fallback URL";h('will fetch fallback url',t,r);var n=await b(e),a=(n.url=r,new Request(r,n)),i=await fetch(a);return h('successfully fetched fallback url',t,r,i),i}catch(e){return null}}(a,n);if(t)return t}throw e}}async function P(e){var t=await(await v()).match(e.request);return t||(e&&e.preloadResponse?await e.preloadResponse:null)||void 0}async function S(e){e=m(e);return e&&await(await v()).match(e)||null}async function R(t){try{var e=await q(t,!0);return h(t.request.url,'nto retrieved from network',e),e}catch(e){return h(t.request.url,'nto not available from network',e),p(503,"The server isn't accessible.")}}async function E(t){var r=t.request.url;try{var n=await q(t,!0);return await g(r,n),h(r,'ntf available from network and cached',n),n}catch(e){n=await P(t);return n?(h(r,'ntf fetched from cache',n),n):await S(r)||(h(r,'ntf failed request from network and not available in cache',e),p(503,"The server isn't accessible and the resource does not exist in cache."))}}async function T(e){var t=e.request.url;let r=null;try{var n=await P(e);if(n){if(h(t,'cfr available in cache',n),0!==n.status)return n;h('opaque cached response available cfr',r),r=n}var a=await q(e,!0);return await g(e.request.url,a),h(t,'cfr retrieved from network and cached',a),a}catch(e){return r?(h('returning cached opaque response cfr',r),r):await S(t)||p(503,"The resource does not exist in cache and the server isn't accessible.")}}async function x(t){try{new URL(t.request.url);var e=await t.request.formData(),r=function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";let t="";for(var r=0;r<7;r++)t+=e.substr(Math.floor(Math.random()*e.length),1);return t}(),n={id:r,url:e.get("url")||"",title:e.get("title")||"",text:e.get("text")||""},a=e.get("file")||"",i=(a&&(n.buffer=await a.arrayBuffer(),n.type=a.type,n.filename=a.name),s=n,await new Promise(function(r,t){try{let t="progressiersharedfiles";if(!indexedDB)return null;var e=indexedDB.open(t,1);e.onupgradeneeded=function(){try{this.result.createObjectStore(t,{autoIncrement:!0,keyPath:'id'})}catch(e){h(e)}},e.onsuccess=function(){try{var e=this.result.transaction(t,"readwrite").objectStore(t);return h('storing shared file locally',s),e.add(s),r()}catch(e){h(e)}}}catch(e){return h(e),t()}}),new URL(t.request.url));return i.searchParams.set("fileid",r),i.searchParams.set("url",n.url),i.searchParams.set("title",n.title),i.searchParams.set("text",n.text),Response.redirect(i.href,303)}catch(e){return Response.redirect(t.request.url,303)}var s}function U(){return new Promise(async function(r,e){let n=!1;try{setTimeout(function(){n||r()},2e4);let t=[];return i.forEach(function(e){e=async function(t){try{var e=await fetch(t);h('precaching url',t),await g(t,e)}catch(e){h(t+" could not be precached")}}(e);t.push(e)}),await Promise.all(t),n=!0,r()}catch(e){return h(e),n=!0,r()}})}async function k(t,e,r){function n(){return!(3<=(t.retries||0))}var a=function(e,t){try{var r=new Date(e).getTime();return!(60*t*60<((new Date).getTime()-r)/1e3)}catch(e){return!1}}(t.date,24);try{if(!a||!n())throw"must delete request from DB";var i=await b(t),s=(h('processing request now',t.url,i),await fetch(t.url,i));if(h('received response',s),499<s.status)throw t.handler=e,h('retried request return error '+s.status,t.url,'will try again later'),"request resulted in a network error";return(await w(l)).delete(t.id),!0}catch(e){try{t.retries+=1;var o=await w(l);n()&&a&&!r?(h('retried requests failed',t.retries+" attempts",t.url),o.put(t)):o.delete(t.id)}catch(e){h('error accessing indexeddb while updating failed retry request number',e)}return!1}}function D(i,s){return new Promise(async function(n,a){try{let r=[];var e=await w(l);if(!e||!e.openCursor)return n();e.openCursor().onsuccess=async function(e){var t;if(!e.target.result)return-1<(t=await Promise.all(r)).indexOf(!1)?a("Some indexedBD requests could not be completed. They will automatically be retried later."):(h(t.length+' pending requests processed successfully'),n());(t=e.target.result.value||{}).handler&&t.handler!==s||r.push(k(t,s,i)),e.target.result.continue()}}catch(e){return a("Unexpected error processing request in a sync event")}})}function L(e){var t,r={};for(t of e.entries())r[(t[0]||"").toLowerCase()]=t[1];return r}async function O(e,t){switch(e){case"swr":return async function(r){let n=null,a=r.request.url;try{var e=await P(r);let t=q(r,!0);if(r.waitUntil(async function(){try{var e=await t;await g(r.request.url,e),h(a,'swr revalidated',e)}catch(e){}}()),e&&0===e.status)h('cached opaque response available',n=e);else if(e)return h(a,'swr available in cache',e),e;var i=await t,s=i.clone();return h(a,'swr retrieved from network',i),Promise.resolve(s)}catch(e){return n?(h('returning cached opaque response',n),n):await S(a)||p(503,"The server isn't accessible and the request does not exist in cache")}}(t);case"cfr":return T(t);case"ntf":return E(t);case"nto":return R(t);default:return E(t)}}function C(e){var t=(e.request.headers['content-type']||"").split(";")[0];let r={url:e.request.url,method:e.request.method,mime:t||"",destination:e.request.destination||""};t=function(t){var e=(new ResourceMatching).mimes;let r=e.findIndex(e=>e.fn(t));return r=r<0?e.length-1:r}(r);r.mimeIndex=t;let n=null;return a.forEach(function(e){if(!n){let t=0;e.filters.forEach(function(e){(new ResourceMatching).match(r,e)&&(t+=1)}),t<1||t===e.filters.length&&(n=e)}}),n?n.strat:null}function B(i){return new Promise(function(a,e){try{var t;return navigator.setAppBadge?indexedDB?((t=indexedDB.open('progressierBadgeDB',1)).onupgradeneeded=function(e){e.target.result.createObjectStore('badgeStore',{keyPath:'id'}).add({id:'badgeCount',count:0})},t.onerror=function(e){a()},void(t.onsuccess=function(e){let t=e.target.result;e=t.transaction(['badgeStore'],'readwrite');let r=e.objectStore('badgeStore');var n=r.get('badgeCount');n.onsuccess=function(e){e=e.target.result;let t=e?e.count:0;i?(t+=i,navigator.setAppBadge(t)):(t=0,navigator.clearAppBadge()),r.put({id:'badgeCount',count:t}),a()},n.onerror=function(e){a()},e.oncomplete=function(){t.close(),a()}})):a():a()}catch(e){return a()}})}async function N(){try{let t=[];var e=await self.clients.matchAll({type:"window"});if(e.length<1)return null;e.forEach(function(e){a=e;var a,e=new Promise(function(t,e){var r=new MessageChannel;let n=!1;setTimeout(function(){if(!n)return t(!1)},500),r.port1.onmessage=function(e){"yes"===e.data&&(n=!0),t(n)},a.postMessage('is-this-standalone',[r.port2])});t.push(e)});let r=[];(await Promise.all(t)).forEach(function(e){r.push(e?"yes":"no")});var n=r.indexOf("yes");return-1<n?e[n]:null}catch(e){return null}}self.addEventListener('sync',function(e){h('sync event triggered'),e.waitUntil(D(e.lastChance,e.tag))}),self.addEventListener('install',function(e){self.skipWaiting(),e.waitUntil(U())}),self.addEventListener('fetch',function(e){var t=e.request.url||"",r=new URL(t).origin,n=self.location.origin,a=e.request.method,i=e.request.mode,s=e.request.cache;"POST"===a&&t.includes('progressiersharedcontent=true')?e.respondWith(x(e)):(t.includes('http://')||n!==o||"document"!==e.request.destination||e.respondWith(E(e)),n!==o&&r!==o&&(t.includes("https://firebasestorage.googleapis.com/v0/b/pwaa-8d87e.appspot.com")?(h('responding with cache first for firebase storage url',t),e.respondWith(T(e))):function(e,t){let r=!1;return"POST"!==e&&"PUT"!==e||c.forEach(function(e){y(e,t)&&(r=!0)}),r}(a,e.request.url)&&indexedDB?(h('auto retry enable',t),e.respondWith(async function(t){var r=t.request.clone();try{var n=await R(t);if(499<n.status)throw n.statusText||"Server error "+n.status;return n}catch(e){L(r.headers);t=await b(r),n=(t.date=(new Date).toISOString(),t.retries=0,await w(l));return h('request to retry stored in indexdb',t),n.add(t),p(503,"The server isn't accessible. The service worker will retry that request later.")}}(e))):"POST"!==a&&"PUT"!==a||!m(e.request.url)?"GET"!==a||"websocket"===i||"only-if-cached"===s&&"same-origin"!==a||(n=C(e))&&e.respondWith(O(n,e)):(h('fallback url mode',t),e.respondWith(R(e)))))}),self.addEventListener('message',function(e){h(e),"reset-badge-count"===e.data?e.waitUntil(B(0)):e.data&&e.data.msg&&"back-online"===e.data.msg&&e.waitUntil(D(!0,e.data.id))}),self.addEventListener('push',function(t){if(f())h("Push received but not handled by Progressier");else if(self.Notification&&'granted'===self.Notification.permission&&t.data){let e={};try{if(!(e=t.data.json()).title)return void h("missing push title")}catch(e){return void h("invalid push data")}t.waitUntil(Promise.all([self.registration.showNotification(e.title,e),B(1),async function(e){try{e.timestamp=(new Date).toISOString(),(await w(d)).add(e)}catch(e){h(e)}}(e)]))}}),self.addEventListener('notificationclick',function(c){if(f())h("Notification clicked but not handled by Progressier");else{let s=c.notification.data,o=(c.notification.close(),s.url||s.target_url);var e;(o=c.action&&s.actions&&0<s.actions.length&&(e=s.actions.find(e=>e.action===c.action)).url?e.url:o)&&(o.startsWith("/")&&(o=new URL(self.registration.scope).origin+o),c.waitUntil(async function(){try{u=c.notification,await new Promise(async function(c,e){try{let n=u.body,a=u.title,i=await w(d),s=i.openCursor(null,'prev'),o=0;s.onsuccess=function(){try{var e,t,r=s.result;return r?(e=r.value||{},20<=o?c():void(e.title===a&&e.body===n?(e.wasClicked=(new Date).toISOString(),(t=i.put(e)).onsuccess=function(){c()},t.onerror=function(){c()}):(o+=1,r.continue()))):c()}catch(e){c()}},s.onerror=function(){c()}}catch(e){c()}});var e=await N();if(e){e.postMessage({msg:'redirect-pwa-from-push',url:o});try{e.focus()}catch(e){h(e)}}else{var t=self.registration.scope;let e=t;t.includes("installable.app")||!s.starturl&&""!==s.starturl||(e=new URL(t).origin+"/"+s.starturl);var r=(o+'/').includes(t),n=btoa(o),a=e.includes("?")?"&":"?",i=r?o:e+a+"pwaredirect="+n;await clients.openWindow(i)}await B(0)}catch(e){h(e)}var u}()))}});